 #idor #hpp
# summary 
- parameter pollution and change request method
## Bypassing ACLs – IDOR exploitation via HPP

This API had some very interesting endpoints as you’d expect. What stood up to us was the fact that the design was a bit awkward. For example, in order to fetch the details of the current logged in user, you need to pass the current customer id as a path parameter in the url. Why do this in the first place? Why not take the id from the session or from the (signed & verified) JWT token? Anyway, this looks like a great target for an IDOR/BOLA issue, doesn’t it?

As you’d expect, we tried to increment/decrement the customer id in the URL, but no luck. The next idea we had, was shall we try and HPP attack, to see what happens? HPP essentially means adding another parameter with the same name as an existing parameter, in this case the customer id. But how shall we name this parameter? We need to to guess the name exactly! So, we had a look at the JSON response and we saw the “customerId” key. Developers are in general pretty consistent, so let’s add a new parameter called customerId as a GET parameter and check what happens. Below you can see how we’ve exploited the /customers/<<customer_id>> endpoint to steal PII of another customer by simply adding a GET parameter with the name customerid and a random integer value.

![Gett Customer API endpoint - IDOR exploited via HPP to steal PII of another customer](https://fortbridge.co.uk/wp-content/uploads/2024/06/get_customer_original_pixelised-1024x609.png)

This was a systemic issue that affected the entire API, not just one endpoint. Bellow you can see how we exploited the `/addresses/<<customerid>>` endpoint to leak all the registered addresses of any customer.
![[Pasted image 20250824175942.png]]

## Bypassing the Fix

It goes without saying, that our initial discovery caused a lot of panic and people jumped on it and remediated the issue asap. Once a fix was in pace, we started looking for a way to bypass it. What we found was that out of the many API endpoints that were vulnerable to our previous exploit, there was one where we could bypass the fix by moving the GET parameter to POST. Probably because multiple teams have worked on this API and they used a different tech stack. Also luckily, this bypass did not seem as critical as we have obtained only limited information, no PII leak this time. In this case we were getting back some information about the return orders of some arbitrary client. However, their internal decision was to also treat this as critical and fixed promptly.

![[Pasted image 20250824180019.png]]

https://fortbridge.co.uk/research/idor-exploitation-via-hpp-api-hacking-case-study/